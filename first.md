# Компиляция и низкоуровневые штуки

## Как компилируется программа в С++

Можно выделить три этапа.

1. Препроцессор
2. Компиляция
3. Линковка(компоновка)

На первом этапе выполняются директивы препроцессора, то есть всё, что начинается с `#`(например #define, #include)

На втором этапе:
- На вход компилятору поступает код на С++ после обработки препроцессором.
- Каждый файл с кодом компилируется отдельно и независимо от других файлов с кодом.
- Компилируется только файлы с кодом (т.е. *.cpp).
- Заголовочные файлы сами по себе ни во что не компилируются, только в составе файлов с кодом.
- На выходе компилятора из каждого файла с кодом получается "объектный файл" — бинарный файл со скомпилированным кодом (с расширением о или .obj).


На третьем этапе все объектные файлы объединяются в один исполняемый (или библиотечный) файл.

## Архитектура фон Неймана

Современных компьютеры построены по принципам архитектуры фон Неймана:
1. Принцип однородности памяти.
   Команды и данные хранятся в одной и той же памяти и внешне в памяти неразличимы.
2. Принцип адресности.
   Память состоит из пронумерованных ячеек.
3. Принцип программного управления.
   Все вычисления представляются в виде последовательности команд.
4. Принцип двоичного кодирования.
   Вся информация (данные и команды) кодируются двоичными числами.

## Сегментация памяти

- Оперативная память, используемая в программе на C++, разделена на области двух типов:
1. сегменты данных,
2. сегменты кода (текстовые сегменты).
- В сегментах кода содержится код программы.
- В сегментах данных располагаются данные программы (значения переменных, массивы и пр.).
- При запуске программы выделяются два сегмента данных:
1. сегмент глобальных данных,
2. стек (для локальных переменных).
- В процессе работы программы могут выделяться и освобождаться дополнительные сегменты памяти.
- Обращения к адресу вне выделенных сегментов - ошибка времени выполнения


## Стек вызовов
- Стек вызовов — это сегмент данных, используемый для хранения локальных переменных и временных значений.
- Не стоит путать стек с одноимённой структурой данных, у стека в С++ можно обратиться к произвольной ячейке.
- Стек выделяется при запуске программы.
- Стек обычно небольшой по размеру (4М6).
- Функции хранят свои локальные переменные на стеке.
- При выходе из функции соответствующая область стека объявляется свободной.
- Промежуточные значения, возникающие при вычислении сложных выражений, также хранятся на стеке.

