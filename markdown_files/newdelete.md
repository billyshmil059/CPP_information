# Управление памятью в C++: `new`, `delete`.

## Оператор `new`

Оператор `new` в C++ используется для выделения памяти в куче под переменную или объект. При этом автоматически вызывается конструктор объекта:

```cpp
int *p = new int(42); // выделение памяти и инициализация значением 42
std::cout << *p << std::endl; // вывод: 42
delete p; // освобождение памяти
```

Особенности:

* Возвращает указатель указанного типа (не `void*`, как `malloc`).
* При нехватке памяти генерирует исключение `std::bad_alloc`.
* Имеет форму `new[]` для массивов:

```cpp
double *arr = new double[5];
// ...
delete[] arr; // важно: delete[]
```

> **Важно:** `new[]` должен освобождаться `delete[]`, а не `delete`.

## Оператор `delete`

Оператор `delete` освобождает память, выделенную через `new`, и вызывает деструктор объекта:

```cpp
struct A {
    A()   { std::cout << "Constructor\n"; }
    ~A()  { std::cout << "Destructor\n";  }
};

A *obj = new A();  // Constructor
delete obj;        // Destructor
```

Особенности:

* `delete` вызывает деструктор и освобождает память.
* Для массивов используется `delete[]`:

```cpp
int *arr = new int[10];
delete[] arr; // вызывает деструкторы всех элементов
```

> **Важно:** `delete` использовать только с указателями, полученными через `new`.

Нельзя использовать `delete` для:

* Указателя на локальный объект
* `malloc`-выделенной памяти
* Повторного освобождения одного и того же указателя (double delete)

Пример ошибки:

```cpp
int *p = new int;
delete p;
delete p; // ОШИБКА: повторное освобождение
```
